{% extends 'layout/base.html' %}

{% block content %}
<h1 class="text-center text-success m-5">CHI TI·∫æT S·∫¢N PH·∫®M</h1>

<div class="container">
    <div class="row d-flex justify-content-between">
        <div class="col-md-4 p-1" style="border: 1px solid black; border-radius: 5px">
            <img title="{{ book.name }}" class="card-img-top" src="{{ book.image }}" alt="{{ book.name }}<">
            {% for a in auths %}
            <h6 title="{{ a.name }}" class="details-item mt-3 ms-1 me-1">T√°c gi·∫£:
                <span style="font-weight: normal">{{ a.name }}</span></h6>
            {% endfor %}
            <h6 title="{{ book.published_date }}" class="details-item mt-2 ms-1 me-1">Ng√†y ph√°t h√†nh:
                <span style="font-weight: normal">{{ book.published_date|date:"d-M-Y" }}</span></h6>
            <h6 class="details-item mt-2 ms-1 me-1">Th·ªÉ lo·∫°i:
                {% for c in cates %}
                <a title="{{ c.name }}" href="/?cate_id={{ c.id }}" style="font-weight: normal"
                   class="pe-0 cate">{{ c.name }}</a>
                {% if not forloop.last %}
                <span class="m-0 p-0">, </span>
                {% endif %}
                {% endfor %}
            </h6>
        </div>
        {% load humanize %}
        <div class="details-info col-md-7">
            <h1 title="{{ book.name }}" class="details-title m-2 mt-3">{{ book.name }}</h1>
            <p title="{{ book.description }}" class="details-description m-2 mb-5">{{ book.description }}</p>

            {% if book.discount.is_active %}
            {% load mathfilters %}
            {% with discount=book.price|mul:book.discount.amount %}
            {% with discount_price=book.price|sub:discount|floatformat %}
            <h5 title="{{ book.price|intcomma }}" class="text-muted">
                <del>
                    {{ book.price|intcomma }} VNƒê
                </del>
            </h5>
            <h3 title="{{ discount_price|intcomma }} VNƒê" class="text-danger">
                {{ discount_price|intcomma }} VNƒê</h3>
            <div class="d-flex mt-3">
                <a href="" onclick=""
                   class="btn btn-primary m-1" style="font-size: 1.1rem">üí≥ Mua s√°ch</a>
                <a onclick="addToCart('{{ book.id }}', '{{ book.name }}', '{{ discount_price }}')"
                   class="btn btn-danger m-1" href="" style="font-size: 1.1rem">&#128722; Th√™m v√†o gi·ªè</a>
            </div>
            {% endwith %}{% endwith %}

            {% else %}
            <h3 title="{{ book.price|intcomma }}"
                class="text-danger">{{ book.price|intcomma }} VNƒê</h3>
            <div class="d-flex mt-3">
                <button onclick="payDirect('{{ book.id }}', '{{ book.name }}', '{{ book.price }}')"
                        type="button"
                        class="btn btn-primary m-1" style="font-size: 1.1rem">üí≥ Mua s√°ch
                </button>
                <a onclick="addToCart('{{ book.id }}', '{{ book.name }}', '{{ book.price }}')"
                   class="btn btn-danger m-1" href="" style="font-size: 1.1rem">&#128722; Th√™m v√†o gi·ªè</a>
            </div>
            {% endif %}

        </div>
    </div>
</div>
<div class="m-2">
    <hr/>
    {% if user.is_authenticated %}
    <div class="m-1">
                    <textarea class="form-control" rows="3" id="comment" placeholder="N·ªôi dung b√¨nh lu·∫≠n..."
                              name="content" value=""></textarea>
        <button type="submit" class="btn btn-success mt-1" onclick="addComment('{{ book.id }}')">B√¨nh lu·∫≠n
        </button>
    </div>
    {% else %}
    <p class=" ms-5">Vui l√≤ng
        <a class="text-info lg" href="/login?next=/books/{{ book.id }}">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ b√¨nh lu·∫≠n!</p>
    {% endif %}
    <hr/>

    <div class="spinner-grow text-primary spinner"></div>

    <ul class="list-group mt-2" id="comments">

    </ul>
</div>

<style>
    a.lg:hover {
        text-decoration: underline;
    }

    .cate {
        color: black;
        margin-right: -4px;
    }

    .cate:hover {
        color: #1DA1F2;
    }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js"></script>

<script>
    window.onload = () => {
        loadComments('{{ book.id }}')
    }
</script>

{% endblock %}